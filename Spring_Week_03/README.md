## ğŸ¯ ëª©í‘œ
### ìŠ¤í”„ë§ í…œí”Œë¦¿ ì´í•´í•˜ê¸°.

### ğŸ“Œ í•™ìŠµí•  ê²ƒ
- [ë‹¤ì‹œë³´ëŠ” ì´ˆë‚œê° DAO](#ë‹¤ì‹œë³´ëŠ”-ì´ˆë‚œê°-dac)
- [ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ](#ë³€í•˜ëŠ”-ê²ƒê³¼-ë³€í•˜ì§€-ì•ŠëŠ”-ê²ƒ)
- [JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”](#jdbc-ì „ëµ-íŒ¨í„´ì˜-ìµœì í™”)
- [ì»¨í…ìŠ¤íŠ¸ì™€ DI](#ì»¨í…ìŠ¤íŠ¸ì™€-di)
- [í…œí”Œë¦¿ê³¼ ì½œë°±](#í…œí”Œë¦¿ê³¼-ì½œë°±)
- [ìŠ¤í”„ë§ì˜ JDBC í…œí”Œë¦¿](#ìŠ¤í”„ë§ì˜-jdbc-í…œí”Œë¦¿)

---

Week 01ì—ì„œ ì´ˆë‚œê° DAO ì½”ë“œì— DIë¥¼ ì ìš©í•´ë‚˜ê°€ëŠ” ê³¼ì •ì—ì„œ ê´€ì‹¬ì‚¬ê°€ ë‹¤ë¥¸ ì½”ë“œë“¤ì„ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ë¶„ë¦¬í•´ë³´ì•˜ë‹¤.

ì´ ê³¼ì •ì—ì„œ í™•ì¥ì—ëŠ” ììœ ë¡­ê²Œ ì—´ë ¤ ìˆê³  ë³€ê²½ì—ëŠ” êµ³ê²Œ ë‹«í˜€ ìˆë‹¤ëŠ” `ê°œë°© íì‡„ ì›ì¹™(OPC)`ì´ ì ìš©ëœ ì„¤ê³„êµ¬ì¡°ì— ëŒ€í•´ì„œ ë°°ìš¸ ìˆ˜ ìˆì—ˆë‹¤.

`OPC`ëŠ” ì½”ë“œì—ì„œ ì–´ë–¤ ë¶€ë¶„ì€ ë³€ê²½ì„ í†µí•´ ê·¸ ê¸°ëŠ¥ì´ ë‹¤ì–‘í•´ì§€ê³  í™•ì¥í•˜ë ¤ëŠ” ì„±ì§ˆì´ ìˆê³ , ì–´ë–¤ ë¶€ë¶„ì€ ê³ ì •ë˜ì–´ ìˆê³  ë³€í•˜ì§€ ì•Šìœ¼ë ¤ëŠ” ì„±ì§ˆì´ ìˆìŒì„ ì•Œë ¤ì¤€ë‹¤.

`í…œí”Œë¦¿`ì´ë€ í›„ìì˜ ì„±ì§ˆì²˜ëŸ¼ ë³€ê²½ì´ ê±°ì˜ ì¼ì–´ë‚˜ì§€ ì•Šìœ¼ë©° ì¼ì •í•œ íŒ¨í„´ìœ¼ë¡œ ìœ ì§€ë˜ëŠ” í‹ì„±ì„ ê°€ì§„ ë¶€ë¶„ì„ ììœ ë¡­ê²Œ ë³€ê²½ë˜ëŠ” ì„±ì§ˆì„ ê°€ì§„ ë¶€ë¶„ìœ¼ë¡œë¶€í„° ë…ë¦½ì‹œì¼œì„œ íš¨ê³¼ì ìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì£¼ëŠ” ë°©ë²•ì´ë‹¤.

## ë‹¤ì‹œë³´ëŠ” ì´ˆë‚œê° DAO

ì´ì „ê¹Œì§€ ê°œì„ í•´ì™”ë˜ UserDaoì˜ ì½”ë“œì—ëŠ” ì˜ˆì™¸ìƒí™©ì— ëŒ€í•œ ì ì ˆí•œ ì²˜ë¦¬ê°€ ì—†ê¸° ë•Œë¬¸ì— ê·¸ ë¶€ë¶„ì— ëŒ€í•œ ê°œì„ ì´ í•„ìš”í•˜ë‹¤.

### ì˜ˆì™¸ì²˜ë¦¬ ê¸°ëŠ¥ì„ ê°–ì¶˜ DAO

DB ì»¤ë„¥ì…˜ì´ë¼ëŠ” ì œí•œì ì¸ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•´ ì‚¬ìš©í•˜ëŠ” ì„œë²„ì—ì„œ ë™ì‘í•˜ëŠ” JDBC ì½”ë“œì— ì˜ˆì™¸ì²˜ë¦¬ëŠ” ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ì›ì¹™ì´ë‹¤.

---

## ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ


---

## JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”

ì•ì—ì„œ `deleteAll()` ë©”ì†Œë“œì— ë‹´ê²¨ ìˆë˜ ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„, ìì£¼ ë³€í•˜ëŠ” ë¶€ë¶„ì„ ì „ëµ íŒ¨í„´ì„ ì‚¬ìš©í•´ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬í•´ëƒˆë‹¤. 

ì´ë²ˆì—” `add()` ë©”ì†Œë“œì—ë„ ë³€í•˜ëŠ” ë¶€ë¶„ì¸ **PreparedStatement** ë¥¼ ë§Œë“œëŠ” ì½”ë“œë¥¼ **AddStatement í´ë˜ìŠ¤** ë¡œ ì˜®ê²¨ ë‹´ì•„ë³´ë©° ë™ì¼í•˜ê²Œ ì ìš©í•´ë³´ì.

> UserDaoì˜ add() ë©”ì†Œë“œ
```java
private Datasource dataSource;

public void add(User user) throws ClassNotFoundException, SQLException {
  Connection c = dataSource.getConnection();
  
  PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values(?, ?, ?)");
  
  ps.setString(1, user.getId());
  ps.setString(2, user.getName());
  ps.setString(3, user.getPassword());
  
  ps.executeUpdate();
  
  ps.close();
  c.close();
}
```

> add() ë©”ì†Œë“œì˜ PreparedStatement ìƒì„± ë¡œì§ì„ ë¶„ë¦¬í•œ AddStatement í´ë˜ìŠ¤
```java

public class AddStatement implements StatementStrategy{
  User user; // deleteAll()ê³¼ëŠ” ë‹¬ë¦¬ add()ì—ëŠ” userë¼ëŠ” ë¶€ê°€ì •ì¸ ì •ë³´ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì „ëµì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ì„ ì–¸í•´ì¤˜ì•¼ í•¨.
  
  public AddStatement(User user){ // ìƒì„±ìë¥¼ í†µí•´  user ì •ë³´ë¥¼ ì „ë‹¬ë°›ìŒ.
    this.user = user;
  }
  
  public PreparedStatement makePreparedStatement(Connection c) throws SQLException{
    PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values(?, ?, ?)");
    
    ps.setString(1, user.getId());
    ps.setString(2, user.getName());
    ps.setString(3, user.getPassword());
    
    return ps;
  }
}
```

> userì •ë³´ë¥¼ AddStatementì— ì „ë‹¬í•´ì£¼ëŠ” add() ë©”ì†Œë“œ
```java
public void add(User user) throws SQLException{
  StatementStrategy st = new AddStatement(user);
  jdbcContextWithStatementStrategy(st);
}
```

ì´ë ‡ê²Œ `deleteAll()` ì²˜ëŸ¼ `add()` ë˜í•œ **PreparedStatement**ë¥¼ ì‹¤í–‰í•˜ëŠ” **JDBC try/catch/finally ì»¨í…ìŠ¤íŠ¸**ë¥¼ ê³µìœ í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëë‹¤.

ì•ìœ¼ë¡œ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì˜ DAO ë©”ì†Œë“œê°€ í•„ìš”í•  ë•Œ ë§ˆë‹¤ ìœ„ì™€ ê°™ì€ ì „ëµì„ ì‚¬ìš©í•˜ë©´ DAO ì½”ë“œì˜ ì–‘ì„ ë§ê²ŒëŠ” 70~80% ê°€ëŸ‰ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

### ì „ëµê³¼ í´ë¼ì´ì–¸íŠ¸ì˜ ë™ê±°

í˜„ì¬ ë§Œë“¤ì–´ì§„ êµ¬ì¡°ë¥¼ ì§„ë‹¨í•˜ì—¬ 2ê°€ì§€ ë” ê°œì„ í•  ë¶€ë¶„ì„ ì°¾ì•„ë³´ì.

1. DAO ë©”ì†Œë“œë§ˆë‹¤ ìƒˆë¡œìš´ **StatementStrategy êµ¬í˜„ í´ë˜ìŠ¤**ë¥¼ ë§Œë“¤ì–´ì•¼ í•¨.

    - ê¸°ì¡´ UserDaoë•Œë³´ë‹¤ í´ë˜ìŠ¤ íŒŒì¼ì˜ ê°œìˆ˜ê°€ ë§ì´ ëŠ˜ì–´ë‚˜ê¸° ë•Œë¬¸ì—, ëŸ°íƒ€ì„ì‹œì— ë™ì ìœ¼ë¡œ DI í•´ì¤€ë‹¤ëŠ” ì ì„ ì œì™¸í•˜ë©´ ë¡œì§ë§ˆë‹¤ ìƒì†ì„ ì‚¬ìš©í•˜ëŠ” í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì„ ì ìš©í–ˆì„ ë•Œë³´ë‹¤ ê·¸ë‹¤ì§€ ë‚˜ì„ ê²Œ ì—†ê²Œ ëœë‹¤ëŠ” ê²ƒì„ ëœ»í•˜ê¸° ë•Œë¬¸ì— ê°œì„ ì´ í•„ìš”í•˜ë‹¤.
2. DAO ë©”ì†Œë“œì—ì„œ **StatementStrategy**ì— ì „ë‹¬í•  Userì™€ ê°™ì€ ë¶€ê°€ì ì¸ ì •ë³´ê°€ ìˆëŠ” ê²½ìš°, ì´ë¥¼ ìœ„í•´ ì „ë‹¬ë°›ëŠ” ìƒì„±ìì™€ ì´ë¥¼ ì €ì¥í•´ë‘˜ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ë²ˆê±°ë¡­ê²Œ ë§Œë“¤ì–´ì•¼ í•¨.

    - ì´ ì˜¤ë¸Œì íŠ¸ê°€ ì‚¬ìš©ë˜ëŠ” ì‹œì ì€ ì»¨í…ìŠ¤íŠ¸ê°€ ì „ëµ ì˜¤ë¸Œì íŠ¸ë¥¼ í˜¸ì¶œí•  ë•Œì´ë¯€ë¡œ ì ì‹œë¼ë„ ì–´ë”˜ê°€ì— ì €ì¥í•´ë‘˜ ìˆ˜ë°–ì— ì—†ë‹¤.

> í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ë²•
### ë¡œì»¬ í´ë˜ìŠ¤

**StatementStrategy** ì „ëµ í´ë˜ìŠ¤ë¥¼ ë§¤ë²ˆ ë…ë¦½ëœ íŒŒì¼ë¡œ ë§Œë“¤ì§€ ë§ê³  **UserDao í´ë˜ìŠ¤ ì•ˆ (add() ë©”ì†Œë“œ) ì— ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì •ì˜í•¨** ìœ¼ë¡œì¨ í´ë˜ìŠ¤ íŒŒì¼ì´ ë§ì´ì§€ëŠ” ë¬¸ì œë¥¼ ê°„ë‹¨í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

> `add()` ë©”ì†Œë“œ ë‚´ì˜ ë¡œì»¬ í´ë˜ìŠ¤ë¡œ ì´ì „í•œ **AddStatement**
```java
public void add(final User user) throws SQLException {
  class AddStatement implements StatementStrategy {
    public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
      PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values (?, ?, ?)");
      
      ps.setString(1, user.getId());
      ps.setString(2, user.getName());
      ps.setString(3, user.getPassword());
      
      return ps;
    }
  }
  
  StatementStrategy st = new AddStatement(user);
  jdbcContextWithStatementStrategy(st);
}
```

ë§ˆì¹˜ ë¡œì»¬ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ë“¯ì´ ë©”ì†Œë“œì•ˆì— ë¡œì»¬ í´ë˜ìŠ¤ë¥¼ ì„ ì–¸í•˜ë©´ ì„ ì–¸ëœ ë©”ì†Œë“œ ë‚´ì—ì„œë§Œ í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

**AddStatement** ê°€ ì‚¬ìš©ë  ê³³ì´ `add()` ë©”ì†Œë“œë¿ì´ë¼ë©´, ìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ì „ì— ë°”ë¡œ ì •ì˜í•´ì„œ ì‚¬ìš©í•˜ë©´ 3ê°€ì§€ ë¶€ë¶„ì—ì„œ ì¥ì ì´ ìˆë‹¤.

1. í´ë˜ìŠ¤ íŒŒì¼ì´ ì¤„ì–´ë“¦. (1ë²ˆ ë¬¸ì œ í•´ê²°)
2. `add()` ë©”ì†Œë“œ ì•ˆì—ì„œ **PreparedStatement** ìƒì„± ë¡œì§ì„ í•¨ê»˜ ë³¼ ìˆ˜ ìˆì–´ ì½”ë“œ ì´í•´ê°€ ìœ ë¦¬í•¨.
3. ìì‹ ì´ ì„ ì–¸ëœ ê³³ì˜ ì •ë³´ì— ì ‘ê·¼ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— **AddStatement** í´ë˜ìŠ¤ê°€ `add()` ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„° userë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. (2ë²ˆ ë¬¸ì œ í•´ê²°)
    - ë‹¤ë§Œ ë‚´ë¶€ í´ë˜ìŠ¤ì—ì„œ ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë• ë°˜ë“œì‹œ í•´ë‹¹ ë³€ìˆ˜ `final`ë¡œ ì„ ì–¸, user íŒŒë¼ë¯¸í„°ê°€ ë©”ì†Œë“œ ë‚´ë¶€ì—ì„œ ë³€ê²½ë  ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— `final`ë¡œ ì„ ì–¸í•´ì¤˜ë„ ë¬´ë°©í•¨

> í•œë²ˆ ë” ìµœì í™”
### ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤

ìë°”ì—ëŠ” ì´ë¦„ì¡°ì°¨ í•„ìš” ì—†ëŠ” **`ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤`** ê°€ ì¡´ì¬í•œë‹¤.

> **`ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤`**
> 
> ì´ë¦„ì„ ê°–ì§€ ì•ŠëŠ” í´ë˜ìŠ¤ë¡œì¨, ì¬ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ê³  êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ìœ¼ë¡œë§Œ ì‚¬ìš©í•  ê²½ìš°ì— ìœ ìš©í•˜ë‹¤. 
> 
> í´ë˜ìŠ¤ ì„ ì–¸ê³¼ ì˜¤ë¸Œì íŠ¸ ìƒì„±ì´ ê²°í•©ëœ í˜•íƒœë¡œ ë§Œë“¤ì–´ì§€ë©°, ìƒì†í•  í´ë˜ìŠ¤ë‚˜ êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±ì ëŒ€ì‹  ì‚¬ìš©í•´ì„œ ì•„ë˜ê³¼ ê°™ì€ í˜•íƒœë¡œ ì‚¬ìš©í•¨.
> 
> ```java
> new ì¸í„°í˜ì´ìŠ¤ì´ë¦„() { í´ë˜ìŠ¤ ë³¸ë¬¸ };
> ```

> **AddStatement** ë¥¼ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“  `add()` ë©”ì†Œë“œ
```java
public void add(final User user) throws SQLException {
  jdbcContextWithStatementStrategy (
    new StatementStrategy() {
      public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
        PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values (?, ?, ?)");

        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());

        return ps;
      }
    }
  );
}
```

ì–´ì°¨í”¼ í´ë˜ìŠ¤ íŒŒì¼ì„ ìƒì„±í•˜ì§€ ì•Šê³  **AddStatement** ëŠ” `add()` ë©”ì†Œë“œ ì•ˆì—ì„œ 1íšŒì„±ìœ¼ë¡œ ì‚¬ìš© í•  ëª©ì ì´ê¸° ë•Œë¬¸ì— ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ìƒì„±í•˜ëŠ” ê²ƒì´ ì ì ˆí•˜ë‹¤.

ê·¸ë¦¬ê³  ë§Œë“¤ì–´ì§„ ìµëª… ë‚´ë¶€ í´ë˜ì˜ ì˜¤ë¸Œì íŠ¸ëŠ” ë”± í•œ ë²ˆë§Œ ì‚¬ìš©í•  ê²ƒì´ ë•Œë¬¸ì— êµ³ì´ ë³€ìˆ˜ì— ë‹´ì•„ë‘˜ í•„ìš” ì—†ì´ `jdbcContextWithStatementStrategy()` ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ì—ì„œ ë°”ë¡œ ìƒì„±í•˜ëŠ” í¸ì´ ë‚«ë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ **DeleteAllStatement**ë„ `deleteAll()` ë©”ì†Œë“œë¡œ ê°€ì ¸ì™€ì„œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

> **DeleteAllStatement** ë„ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“  `deleteAll()` ë©”ì†Œë“œ
```java
public void deleteAll() throws SQLException {
  jdbcContextWithStatementStrategy (
    new StatementStrategy() {
      public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
        return c.preparedStatement("delete from users");
      }
    }
  );
}
```

---

## ì»¨í…ìŠ¤íŠ¸ì™€ DI


---

## í…œí”Œë¦¿ê³¼ ì½œë°±


---

## ìŠ¤í”„ë§ì˜ JDBC í…œí”Œë¦¿
